<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
    <title>Migrating to the cloud: The end · Hugo Themes</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="http://localhost:1313/style.main.min.b98e12e6b4acb157747422458845caf0880e6eda788e2e2ee3ecc617a0e9bfc3.css" />

</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
    <div class="site-nav-left">
        
        <a class="site-nav-logo" href="http://localhost:1313/">Hugo Themes</a>
        

        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem">
                    <a href="/">HOME</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="/my-setup">MY SETUP</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="/story">THE STORY</a>
                </li>
                
            </ul>

            
            <span class="nav-post-title dash">Migrating to the cloud: The end</span>
            
        </div>
    </div>

    <div class="site-nav-right">
        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem">
                    <a href="https://www.linkedin.com/in/bradley-stannard/">Linkedin</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="https://documentation.breadnet.co.uk/?mtm_campaign=breadnet&amp;mtm_kwd=navbar">Documentation</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="mailto:webmaster@breadnet.co.uk">Contact</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="https://github.com/userbradley">GitHub</a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>
</div>
</div><script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.Casper && window.Casper.stickyNavTitle) {
                window.Casper.stickyNavTitle({
                    navSelector: '.site-nav-main',
                    titleSelector: '.post-full-title',
                    activeClass: 'nav-post-title-active'
                });
            }
        });
    </script>
</header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post  no-image ">

            <header class="post-full-header">

                

                <h1 class="post-full-title">Migrating to the cloud: The end</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        

                        <section class="post-full-byline-meta">
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="0001-121-01">1 January 0001</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 5 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            

            <section class="post-full-content">
                <div class="post-content">
                    <p>This is the final post in my *Migrating to the cloud *trio. Just like Orange is the new black, it can only get worse after the 3rd installment.
[</p>
<p>breadNET Cloud Migration</p>
<p>How did I move all my servers to the cloud? Well - Ansible, automation and CI/CD!</p>
<p><img src="https://breadnet.co.uk/favicon.png" alt="">breadNETBradley Stannard</p>
<p><img src="https://images.unsplash.com/photo-1560182413-53772f3d7134?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="">
](<a href="https://breadnet.co.uk/moving-to-the-cloud-1/)%5B">https://breadnet.co.uk/moving-to-the-cloud-1/)[</a></p>
<p>Moving to the cloud: Infrastructure</p>
<p>Part 2 of moving to the cloud - Let’s talk about IaC</p>
<p><img src="https://breadnet.co.uk/favicon.png" alt="">breadNETBradley Stannard</p>
<p><img src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=MnwxMTc3M3wwfDF8c2VhcmNofDEzfHxjb2RlfGVufDB8fHx8MTYxNzUwMzcyMA&amp;ixlib=rb-1.2.1&amp;q=80&amp;w=2000" alt="">
](<a href="https://breadnet.co.uk/moving-to-the-cloud-2/">https://breadnet.co.uk/moving-to-the-cloud-2/</a>)
In the previous years, I wrote about migrating from servers in my parents garage to being on the cloud.</p>
<p>Since then, breadNET has changed a lot!</p>
<p>We&rsquo;ve gone from being running 100% on premise, to 50/50, to 70/30 then back on premise and then back to the cloud. It&rsquo;s been quite a mish mash of moving around.</p>
<p>After about 3 years (almost to the date) I have 100% migrated to the cloud, and now have everything stored as code in git.</p>
<p>We&rsquo;re going to take a look at the issues I had during the migration, the data I&rsquo;ve had to put on ice and the career changes that aided these migrations.</p>
<h1 id="first-there-was-the-iac">First there was the IaC</h1>
<p>Previously I migrated all my services to OVH, which was great for getting things set up and running until I was able to get a job that gave me disposable income.</p>
<p>I migrated as many applications as I could to Software as a service - with the most noticeable ones being:</p>
<ul>
<li>Jira</li>
<li>Git</li>
</ul>
<p>It was not economical for us to run a Jira instance (Requires around 4GB ram and 2 cores - Which costs more on the cloud)</p>
<p>I wanted everything as code, so terraform again. We previously used OVH, which under the hood is <a href="https://www.openstack.org?ref=breadnet.co.uk">Open Stack</a>. We can use the <a href="https://m.do.co/c/77be3c3aa96c">Digital ocean</a> terraform provider to control our account
[</p>
<p>Terraform Registry</p>
<p><img src="https://registry.terraform.io/images/favicons/apple-touch-icon.png" alt=""></p>
<p>](<a href="https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs">https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs</a>)
Since moving to <a href="https://m.do.co/c/77be3c3aa96c">Digital Ocean</a>, I&rsquo;ve found my site is a lot more reliable and latency is a lot lower. Only issue I&rsquo;ve had is it&rsquo;s a little more pricy.</p>
<h2 id="gitops">GitOps</h2>
<p>This is the best thing ever, this basically means using GitHub and CI to build and deploy infrastructure.</p>
<p>This very nicely moves us on to the next part of the migration. Git.</p>
<p>I&rsquo;ve moved all my Git based *activities *to GitHub. all in a single <a href="https://en.wikipedia.org/wiki/Monorepo">Mono Repository</a> meaning that all the code related to my infrastructure is in one place.</p>
<h1 id="accessing-servers">Accessing servers</h1>
<p>I previously wrote about using Pritunl Zero for accessing my servers and internal applications. This method works quite well if all your applications sit on-premise and you have LDAP (as well as the paid plan for Pritunl)</p>
<p>Cloudflare (The people I get my DNS from) also have a feature called Zero. It&rsquo;s pretty much a free zero trust platform that uses the cloudflare edge to terminate your traffic, then send it back out again close to your server.</p>
<p>I&rsquo;ve got this installed on all my servers, meaning I can use my native SSH client to connect, and not having to overwrite my SSH client with the one built by Pritunl.</p>
<p>Below is an example code snippet that goes on the server, <a href="https://documentation.breadnet.co.uk/kb/cloudflared/cloudflared-on-ubuntu-for-ssh/?mtm_campaign=breadnetsite&amp;mtm_kwd=migrating-to-cloud-the-end">once you&rsquo;ve followed the Installing cloudflared on Ubuntu page</a></p>
<pre><code># Server Config
# /etc/cloudflared/config.yml
logDirectory: /var/log/cloudflared
tunnel: 1b70-4325-9bb5
credentials-file: /home/&lt;&gt;/.cloudflared/1b70-4325-9bb51.json
no-autoupdate: true
ingress:
  - hostname: ssh-&lt;server&gt;.breadinfra.net
    service: ssh://127.0.0.1:22
  - service: http_status:404
</code></pre>
<p>Finally, you can then configure your laptop with the below which allows your client to connect over ssh to the server</p>
<pre><code># Laptop Config
# ~/.ssh/config
host unifi
 hostname ssh-&lt;&gt;.breadinfra.net
 user root
 ProxyCommand /opt/homebrew/bin/cloudflared access ssh --hostname %h
</code></pre>
<h1 id="serverless">Serverless</h1>
<p>Serverless is a weird concept. Just means that you don&rsquo;t manage the server, and only deploy a docker container or just your code to it.</p>
<p>A great example of serverless is, my documentation site. I write markdown and then it gets rendered and hosted
[</p>
<p>Welcome</p>
<p>breadNET Documentation</p>
<p><img src="https://documentation.breadnet.co.uk/favicon.ico" alt="">logo</p>
<p><img src="https://documentation.breadnet.co.uk/assets/images/social/index.png" alt="">
](<a href="https://documentation.breadnet.co.uk">https://documentation.breadnet.co.uk</a>)
By migrating <a href="https://breadnet.co.uk/migrating-off-bookstack/">Bookstack to Mkdocs</a> I have been able to save $6 a month, by hosting the site on fly.io.</p>
<p>Not to keep going on, but a great example of why this is great is, it costs me absolutly nothing a month. The Git is free, the CICD is free as it&rsquo;s a public repo
[</p>
<p>GitHub - userbradley/documentation.breadnet.co.uk: breadNET Documentation maintained by @userbradley</p>
<p>breadNET Documentation maintained by @userbradley. Contribute to userbradley/documentation.breadnet.co.uk development by creating an account on GitHub.</p>
<p><img src="https://github.com/fluidicon.png" alt="">GitHubuserbradley</p>
<p><img src="https://opengraph.githubassets.com/7bf95a4efb4f28145e423104c6a29be7324eaad2d2239a569a88da139b1cc82f/userbradley/documentation.breadnet.co.uk" alt="">
](<a href="https://github.com/userbradley/documentation.breadnet.co.uk">https://github.com/userbradley/documentation.breadnet.co.uk</a>)</p>
<h1 id="firewalls">Firewalls</h1>
<p>Cloudflare have Argo Tunnels<code>Cloudflare Tunnels</code>, which allows you to punch out from your device, to the Cloudflare edge opposed to port forwarding. This is great for security as you&rsquo;re no longer doing one of the two:</p>
<ol>
<li>Port forwarding to all the Cloudflare IP ranges</li>
<li>Port forwarding <code>tcp/80</code> and <code>tcp/443</code> to the entire internet</li>
</ol>
<p>All you have to do, if you have restrictive outbound rules, is allow <code>udp/7844</code> and <code>tcp/7844</code></p>
<h1 id="wrapping-it-up">Wrapping it up</h1>
<p>I know this was not the best blog, but if you have noticed, the site has been migrated to a new faster server, and now uses Cloudflare Tunnels (Dog fooding)</p>
<p>I have plans this year to spend some more time working with Kubernetes and possibly running some applications on k3s using cloudflare tunnels.</p>
<p>💸</p>
<p>I&rsquo;m sorry, I have included Digital Ocean Refferal links, it helps keep the lights on. I don&rsquo;t run ads on this site, or track you across the web. I only track you across the site, but as soon as you leave I have no idea what you&rsquo;re up to.</p>
<p>Thank you for your understanding on this, you&rsquo;re welcome to buy me a coffee instead!</p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed"><article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="http://localhost:1313/post/gcs-web-server-using-gcsfuse/">
    
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Mount a GCS bucket to nginx</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p><p>Recently I had to solve a problem where we needed to serve a web page from GCS.</p>
<p>You&rsquo;ve probably come here from googling something like:</p>
<ul>
<li>How to mount a GCS bucket to a docker container</li>
<li>How to mount a GCS bucket to a pod</li>
<li>How to serve a gcs bucket in nginx</li>
</ul>
<p>I know the Hard core Google cloud engineers among us are screaming</p>
<blockquote>
<p><a href="https://cloud.google.com/load-balancing/docs/https/ext-load-balancer-backend-buckets">Why dont you use a load balancer with a GCS bucket as a backend?</a></p></p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="0001-121-01">1 January 0001</time>
                            <span class="bull">&bull;</span> 2 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
    

            <article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="http://localhost:1313/post/migrating-off-bookstack/">
    
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Migrating off of Bookstack</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p><p>Organizing documentation is hard.</p>
<p>I&rsquo;ll start the post off with that.</p>
<hr>
<p>Since I started my home lab back in 2018, I knew I needed a place to write down important information like the server name, where it&rsquo;s located and all the other stuff that goes along with that - Example below:
<img src="__GHOST_URL__/content/images/2022/09/image.png" alt="">
For a long time, that was bookstack. One of my favourite pieces of open source software.</p>
<p>For those of you who aren&rsquo;t familiar with BookStack:</p></p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="0001-121-01">1 January 0001</time>
                            <span class="bull">&bull;</span> 5 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
    
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:1313/">Hugo Themes</a> &copy; 0001</section>
                <nav class="site-footer-nav">
                    <a href="http://localhost:1313/">Latest Posts</a>
                    <a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a>
                    <a href="https://twitter.com" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://github.com/jonathanjanssens" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

<script src="http://localhost:1313/js/sticky-nav-title.min.7c74baa114d72c67b1f5c85f55da35fa76c686efef35103f409f57f6bf3f9057.js" integrity="sha256-fHS6oRTXLGex9chfVdo1&#43;nbGhu/vNRA/QJ9X9r8/kFc="></script>
<script>

    
    
    
    
    $(document).ready(function () {

        var nav = document.querySelector('.site-nav-main .site-nav');
        var feed = document.querySelector('.post-feed');

        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;

        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }

        function onResize() {
            lastWindowHeight = window.innerHeight;
            lastDocumentHeight = $(document).height();
            requestTick();
        }

        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(update);
            }
            ticking = true;
        }

        function update() {
            var trigger = feed.getBoundingClientRect().top + window.scrollY;
            var progressMax = lastDocumentHeight - lastWindowHeight;

            
            if (lastScrollY >= trigger - 20) {
                nav.classList.add('fixed-nav-active');
            } else {
                nav.classList.remove('fixed-nav-active');
            }

            ticking = false;
        }

        window.addEventListener('scroll', onScroll, { passive: true });
        window.addEventListener('resize', onResize, false);

        update();

    });
</script>
</body>
</html>