<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
    <title>Moving to LDAP · Hugo Themes</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="http://localhost:1313/style.main.min.b98e12e6b4acb157747422458845caf0880e6eda788e2e2ee3ecc617a0e9bfc3.css" />

</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
    <div class="site-nav-left">
        
        <a class="site-nav-logo" href="http://localhost:1313/">Hugo Themes</a>
        

        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem">
                    <a href="/">HOME</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="/my-setup">MY SETUP</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="/story">THE STORY</a>
                </li>
                
            </ul>

            
            <span class="nav-post-title dash">Moving to LDAP</span>
            
        </div>
    </div>

    <div class="site-nav-right">
        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem">
                    <a href="https://www.linkedin.com/in/bradley-stannard/">Linkedin</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="https://documentation.breadnet.co.uk/?mtm_campaign=breadnet&amp;mtm_kwd=navbar">Documentation</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="mailto:webmaster@breadnet.co.uk">Contact</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="https://github.com/userbradley">GitHub</a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>
</div>
</div><script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.Casper && window.Casper.stickyNavTitle) {
                window.Casper.stickyNavTitle({
                    navSelector: '.site-nav-main',
                    titleSelector: '.post-full-title',
                    activeClass: 'nav-post-title-active'
                });
            }
        });
    </script>
</header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post  no-image ">

            <header class="post-full-header">

                

                <h1 class="post-full-title">Moving to LDAP</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        

                        <section class="post-full-byline-meta">
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="0001-121-01">1 January 0001</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 5 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            

            <section class="post-full-content">
                <div class="post-content">
                    <p>I run 2 **incredibly **important pieces of software here at breadNET</p>
<ol>
<li>Jira (Project management tool)</li>
<li>Bookstack (Knowledge base articles)</li>
</ol>
<p>The annoyance comes from having to login to them with 2 separate accounts and a lack of <a href="https://en.wikipedia.org/wiki/Multi-factor_authentication">2 factor authentication</a>.</p>
<p>The aim of this blog post is less of a blog, and more of a How to, hence the <a href="__GHOST_URL__/tag/how-to/">How to</a> tag :)</p>
<p>First we will look in to the platform I have decided to go with, why I chose it and what other options there are.</p>
<p>Secondly we will look at setting up LDAP auth for Jira and then Bookstack as well as the issues I faced.</p>
<hr>
<h3 id="what-ldap-system-i-have-gone-with">What LDAP system I have gone with?</h3>
<p>At my old job back as a welpdesk engineer, I was tasked with looking in to a SaaS based platform for windows based authentication. I had come across a platform called <a href="__GHOST_URL__/p/61dd53bc-c56a-4481-a5b3-3af896dcd1f0/jumpcloud.com/">JumpCloud</a> which is a cloud hosted directory platform which pride them selves on &ldquo;<em>An open directory platform for secure, friction-less access from any device to any resource, anywhere</em>&rdquo;  and from the testing and deployments I have done, I can stand behind them and say this is indeed true.</p>
<h3 id="why-i-chose-jumpcloud">Why I chose Jumpcloud</h3>
<p>There are a few reasons on why I chose to go with Jumpcloud over Okta and Microsoft Azure Active directory</p>
<ol>
<li>Jumpcloud is free for up to 10 users, for ever</li>
<li>I have experience with it</li>
<li>I have had long conversations with their sales team, so I know the in&rsquo;s and out&rsquo;s of their platform</li>
<li>It&rsquo;s free.</li>
</ol>
<hr>
<h1 id="setting-up-jira-with-jumpcloud">Setting up Jira with Jumpcloud</h1>
<p>The first step is to sign up to jumpcloud. It&rsquo;s free, so you don&rsquo;t even need to setup a credit card.</p>
<p>Our first step is to create a Bind user. This is the user that Jira and Bookstack will authenticate with to search the directory.</p>
<p>There are rules with this password that I have found make life easier</p>
<ol>
<li>No funky charachters (!&rsquo;@ etc)</li>
<li>No <code>#</code> as in <code>.env</code> files and most config files, this is a comment</li>
</ol>
<p>Create the user, don&rsquo;t bother with their name and stuff, just make the username <code>bind</code> and set the password. Set their email as <a href="mailto:bind@example.org">bind@example.org</a> or a test email account your organisation has -  Ensure you set the password as below or you may face issues.
<img src="__GHOST_URL__/content/images/2021/01/image-1.png" alt="">
Ensure that you click <code>Enable as LDAP Bind DN</code></p>
<p>Once done, click back in and copy the <code>Base DN</code></p>
<p>In my case it&rsquo;s <code>uid=bind,ou=Users,o=5ff9f63bb2433c378b9d8d18,dc=jumpcloud,dc=com</code></p>
<p>Once this is done, we can head over to the groups and start creating groups.</p>
<p>We need these groups to reflect their <strong>exact name</strong> in jira. Example below:
<img src="__GHOST_URL__/content/images/2021/01/image-2.png" alt="">
Two groups that we need to ensure we have is <code>jira-software-users</code> and <code>jira-administrators</code> as without these groups, adding new admins and users becomes pointless as we will need to then go in to jira and add them to the group, which kind of defeats the point of one source of truth.</p>
<p>Ensure that the group is added to the directory:
<img src="__GHOST_URL__/content/images/2021/01/image-4.png" alt="">
Once this is done, we can go and create a user and then ensure we add them to 2 things, the LDAP directory, and then a jira group we created.</p>
<p>Finally, create a user, add them to the <code>jira-software-users</code> group, and to the Directory.</p>
<p>Now we can move on to setting up jira.</p>
<p>Login to Jira server, click settings at the top then select <code>User Management</code>
<img src="__GHOST_URL__/content/images/2021/01/image-5.png" alt="">
On the left hand side, select <code>User Directories</code> then click <code>Add Directory</code> then select LDAP
<img src="__GHOST_URL__/content/images/2021/01/image-6.png" alt="">
Ensure that we set it to use OpenLDAP
<img src="__GHOST_URL__/content/images/2021/01/image-7.png" alt="">
I will break down each field and what to put in there
Field namewhat to put thereNameJumpcloudDirectory typeOpenLDAPHostnameldap.jumpcloud.comPort636 (use SSLUsernamebind username dnPasswordPassword of bind dn userBase DNCopy thr org DN and add <code>ou=Users,</code> to the frontLDAP PermissionsRead only, with Local groupsSecure SSLTick boxNaive DN MatchingTick boxUpdate group membership when logging inEvery time the user logs inSynchronisation Interval (minutes)2User Object ClassinetorgpersonUser Object Filter(objectclass=inetorgperson)User Name AttributeuidUser Name RDN AttributeuidUser First Name AttributegivenNameUser Last Name AttributesnUser Display Name AttributedisplayNameUser Email AttributemailUser Password AttributeuserPasswordUser Password EncryptionSHAUser Unique ID AttributeentryUUIDGroup Object ClassgroupOfNamesGroup Object Filter(objectclass=groupOfNames)Group Name AttributecnGroup Description AttributecnGroup Members AttributememberUser Membership AttributememberOf<img src="__GHOST_URL__/content/images/2021/01/image-8.png" alt=""><img src="__GHOST_URL__/content/images/2021/01/image-9.png" alt=""><img src="__GHOST_URL__/content/images/2021/01/image-10.png" alt=""><img src="__GHOST_URL__/content/images/2021/01/image-11.png" alt=""><img src="__GHOST_URL__/content/images/2021/01/image-12.png" alt="">
Then click save and test.</p>
<p>Go to user management and go to User Directories, then click Sync.</p>
<p>Nice! Now it&rsquo;s set up!</p>
<p>You should see the test user appear and be able to login with their username and password.</p>
<p>If you want to sync users that already have local jira accounts, to ldap, just create their user in Jumpcloud with their email address, username and a new password.</p>
<p>Synch the directory and then delete the local user. You should see a message saying that the user exists in 2 directories. If you don&rsquo;t see this, stop. Fix the synch.</p>
<hr>
<h1 id="bookstack">Bookstack</h1>
<p>Bookstack has some realllllly beautiful documentation so this was a pure breeze, but there&rsquo;s some issues that I came across.</p>
<p>I highly suggest that you start this with creating users and groups in Jumpcloud before making config changes.</p>
<p>Now we can ssh to the server and start to hack at the .env file.</p>
<p>Firstly login as the admin account to your instance, then go to users and your profile.</p>
<p>We need to add the below to the file.</p>
<pre><code>APP_DEBUG=true #change to false once it works

AUTH_METHOD=ldap
LDAP_SERVER=ldaps://ldap.jumpcloud.com:636
LDAP_BASE_DN=ou=Users,o=&lt;org id&gt;,dc=jumpcloud,dc=com
LDAP_DN=uid=bind,ou=Users,o=&lt;org id&gt;,dc=jumpcloud,dc=com
LDAP_PASS=&lt;bind user password&gt;
LDAP_USER_FILTER=(&amp;(uid=${user}))
LDAP_VERSION=3
LDAP_ID_ATTRIBUTE=uid
LDAP_EMAIL_ATTRIBUTE=mail
LDAP_DISPLAY_NAME_ATTRIBUTE=cn
LDAP_USER_TO_GROUPS=true
LDAP_GROUP_ATTRIBUTE=&quot;memberOf&quot;
LDAP_REMOVE_FROM_GROUPS=false
</code></pre>
<p>Replace <code>&lt;org id&gt;</code> with your org id from jumpcloud and <code>&lt;bind user password&gt;</code> with the bind user&rsquo;s password.</p>
<p>Restart nginx or apache or what ever you&rsquo;re running and login with a user account.</p>
<p>Refresh the page on Bookstack and you will see the below
<img src="__GHOST_URL__/content/images/2021/01/image-13.png" alt="">
Fill the box out with the username that you&rsquo;ve used in jumpcloud for your account, then open an incognito window and then try logging in with your jumucloud username</p>
<p>If you see this, then you&rsquo;re in trouble! Get in contact and I can see what I can do to help!
<img src="__GHOST_URL__/content/images/2021/01/image-14.png" alt="">
Once you&rsquo;ve verified that logins work, edit the <code>.env</code> file set <code>APP_DEBUG=false</code> and restart nginx.</p>
<p>Congrats, you now have LDAP setup!</p>
<hr>
<p>You can hire me via <a href="https://www.upwork.com/freelancers/~01c61ee9802b94133e">Upwork</a> or <a href="mailto:work@breadnet.co.uk">emailing me</a> for weekend projects!</p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed"><article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="http://localhost:1313/post/moving-to-the-cloud-2/">
    
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Moving to the cloud: Infrastructure</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p><p>Welcome back!</p>
<p>If you&rsquo;re not seen it, I suggest you have a read of:
[</p>
<p>breadNET Cloud Migration</p>
<p>How did I move all my servers to the cloud? Well - Ansible, automation and CI/CD!</p>
<p><img src="https://breadnet.co.uk/favicon.png" alt="">breadNETBradley Stannard</p>
<p><img src="https://images.unsplash.com/photo-1560182413-53772f3d7134?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="">
](<strong>GHOST_URL</strong>/cloud-migration-part-1/)
In this installment of &ldquo;Something I did at 4am that really should have been done during the day&rdquo; we will be looking at the infrastructure that will be powering my internal services.</p>
<p>I had a lot of issues during this, but let&rsquo;s take a look at the code first.
[</p></p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="0001-121-01">1 January 0001</time>
                            <span class="bull">&bull;</span> 10 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
    

            <article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="http://localhost:1313/post/gcs-web-server-using-gcsfuse/">
    
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Mount a GCS bucket to nginx</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p><p>Recently I had to solve a problem where we needed to serve a web page from GCS.</p>
<p>You&rsquo;ve probably come here from googling something like:</p>
<ul>
<li>How to mount a GCS bucket to a docker container</li>
<li>How to mount a GCS bucket to a pod</li>
<li>How to serve a gcs bucket in nginx</li>
</ul>
<p>I know the Hard core Google cloud engineers among us are screaming</p>
<blockquote>
<p><a href="https://cloud.google.com/load-balancing/docs/https/ext-load-balancer-backend-buckets">Why dont you use a load balancer with a GCS bucket as a backend?</a></p></p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="0001-121-01">1 January 0001</time>
                            <span class="bull">&bull;</span> 2 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
    
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:1313/">Hugo Themes</a> &copy; 0001</section>
                <nav class="site-footer-nav">
                    <a href="http://localhost:1313/">Latest Posts</a>
                    <a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a>
                    <a href="https://twitter.com" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://github.com/jonathanjanssens" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

<script src="http://localhost:1313/js/sticky-nav-title.min.7c74baa114d72c67b1f5c85f55da35fa76c686efef35103f409f57f6bf3f9057.js" integrity="sha256-fHS6oRTXLGex9chfVdo1&#43;nbGhu/vNRA/QJ9X9r8/kFc="></script>
<script>

    
    
    
    
    $(document).ready(function () {

        var nav = document.querySelector('.site-nav-main .site-nav');
        var feed = document.querySelector('.post-feed');

        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;

        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }

        function onResize() {
            lastWindowHeight = window.innerHeight;
            lastDocumentHeight = $(document).height();
            requestTick();
        }

        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(update);
            }
            ticking = true;
        }

        function update() {
            var trigger = feed.getBoundingClientRect().top + window.scrollY;
            var progressMax = lastDocumentHeight - lastWindowHeight;

            
            if (lastScrollY >= trigger - 20) {
                nav.classList.add('fixed-nav-active');
            } else {
                nav.classList.remove('fixed-nav-active');
            }

            ticking = false;
        }

        window.addEventListener('scroll', onScroll, { passive: true });
        window.addEventListener('resize', onResize, false);

        update();

    });
</script>
</body>
</html>