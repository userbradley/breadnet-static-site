<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
    <title>Resolving the &#39;sts:GetCallerIdentity&#39; error ¬∑ Hugo Themes</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="http://localhost:1313/style.main.min.b98e12e6b4acb157747422458845caf0880e6eda788e2e2ee3ecc617a0e9bfc3.css" />

</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
    <div class="site-nav-left">
        
        <a class="site-nav-logo" href="http://localhost:1313/">Hugo Themes</a>
        

        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem">
                    <a href="/">HOME</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="/my-setup">MY SETUP</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="/story">THE STORY</a>
                </li>
                
            </ul>

            
            <span class="nav-post-title dash">Resolving the &#39;sts:GetCallerIdentity&#39; error</span>
            
        </div>
    </div>

    <div class="site-nav-right">
        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem">
                    <a href="https://www.linkedin.com/in/bradley-stannard/">Linkedin</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="https://documentation.breadnet.co.uk/?mtm_campaign=breadnet&amp;mtm_kwd=navbar">Documentation</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="mailto:webmaster@breadnet.co.uk">Contact</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="https://github.com/userbradley">GitHub</a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>
</div>
</div><script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.Casper && window.Casper.stickyNavTitle) {
                window.Casper.stickyNavTitle({
                    navSelector: '.site-nav-main',
                    titleSelector: '.post-full-title',
                    activeClass: 'nav-post-title-active'
                });
            }
        });
    </script>
</header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post  no-image ">

            <header class="post-full-header">

                

                <h1 class="post-full-title">Resolving the &#39;sts:GetCallerIdentity&#39; error</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        

                        <section class="post-full-byline-meta">
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="0001-121-01">1 January 0001</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            

            <section class="post-full-content">
                <div class="post-content">
                    <p>I&rsquo;ll be honest, other than the 90 day delete policy (which annoys me to no end) wasabi is <strong>dank****af</strong>.</p>
<p>Didn&rsquo;t expect me to start a blog post with that, did you? (Looking at you wasabi employees üëÄ)</p>
<h2 id="the-problem-at-hand">The problem at hand</h2>
<p>I&rsquo;m in the middle of a digital transformation, which means re-defining how I do things.</p>
<p>One of those is how I deal with terraform state.</p>
<p>Those of you who don&rsquo;t *terraform on the regular, *let me explain the issue.</p>
<p>Terraform keeps track of what it&rsquo;s created, and what needs to be created or deleted next using a file called <code>terraform.tfstate</code> - which for the most part is a <code>json</code> file, see below.
<img src="__GHOST_URL__/content/images/2022/03/image-8.png" alt="">
Now, when we&rsquo;re scaling our infra over multiple repos, modules etc, and having more people work on them, we get to this stage where we need a better solution on storing (and also versioning) state files.</p>
<p>Terraform has a few solutions you can use, see below
[</p>
<p>Backend Overview - Configuration Language | Terraform by HashiCorp</p>
<p>A backend defines where Terraform stores its state. Learn about how backends work.</p>
<p><img src="https://www.terraform.io/favicon.ico" alt="">Terraform by HashiCorp</p>
<p><img src="https://www.terraform.io/img/og-image.png" alt="">
](<a href="https://www.terraform.io/language/settings/backends">https://www.terraform.io/language/settings/backends</a>)
I&rsquo;ve decided to use s3 over others as:</p>
<ol>
<li>GCS is expensive</li>
<li>AWS S3 is expensive</li>
<li>I already use Wasabi</li>
<li>Terraform cloud is cool, but annoys me for some reason.</li>
<li>The moose on my desk told me to (<a href="__GHOST_URL__/how-i-got-to-where-i-am-now/">See this post to learn more</a>)</li>
</ol>
<h2 id="what-we-can-use-wasabi-for">What we can use wasabi for</h2>
<p>So as it stands, wasabi is AWS S3 compliant - But it&rsquo;s not AWS.</p>
<p>Without sounding like <a href="https://twitter.com/QuinnyPig">Corey Quinn</a> here, this is a stupid naming conventions.</p>
<p>Effectively what it means is you can use the AWS cli to connect to the endpoint that Wasabi offer, or use any other S3 cli to connect. It has the same IAM rules and stuff attached.</p>
<p>If I was to re-do it I would make S3 the standard, then each provider just has their offering.</p>
<p>I digress.</p>
<p>We are going to use wasabi to store our precious <code>terraform.tfstate</code> file, with versioning enabled on the bucket.</p>
<p>This is important as without versioning it&rsquo;s hard to see what has changed for the environment, as well as later down the line using stuff like Open Policy Agent to enforce certain policies against the infrastructure.</p>
<h2 id="the-error-i-had">The error I had</h2>
<p><img src="__GHOST_URL__/content/images/2022/03/image-7.png" alt="">
Error: error configuring S3 Backend: error validating provider credentials: error calling sts:GetCallerIdentity: InvalidClientTokenId: The security token included in the request is invalid.
status code: 403, request id:</p>
<p>What does this error mean?</p>
<p>I&rsquo;ll be honest, I have no clue. I was following the guide that Wasabi put out, <a href="https://wasabi-support.zendesk.com/hc/en-us/articles/360003362071-How-do-I-use-Terraform-with-Wasabi-">here</a> - but it just would not work.</p>
<p>Here&rsquo;s what I had:</p>
<pre><code>terraform {

    backend &quot;s3&quot; {
    access_key = &quot;&lt;WASABI-ACCESS-KEY&gt;&quot;
    secret_key = &quot;&lt;WASABI-SECRECT-KEY&gt;&quot;
    endpoint = &quot;https://s3.uk-1.wasabisys.com&quot;
    region = &quot;us-east-1&quot;
    bucket = &quot;bradleys-terraform-state&quot;
    key = &quot;ovh/terraform.tfstate&quot;
  }
}
</code></pre>
<p>It just would not work. No one else on the internet seems to have fixed this.</p>
<h3 id="except-me-">Except me :)</h3>
<p>Here&rsquo;s what the file was missing - Call it the secret sauce:</p>
<pre><code>skip_credentials_validation = true
</code></pre>
<p>So our block should look something like this</p>
<pre><code>  backend &quot;s3&quot; {
    endpoint = &quot;https://s3.uk-1.wasabisys.com&quot;
    region = &quot;eu-west-1&quot;
    bucket = &quot;bradleys-terraform-state&quot;
    key = &quot;ovh/terraform.tfstate&quot;
    skip_credentials_validation = true
  }
</code></pre>
<p>This seems to have done it!</p>
<hr>
<p>In my next post, we will be looking in to how to set up Wasabi to be a backend for Terraform, as well as the IAM policy required!</p>
<hr>
<h2 id="a-meme">A meme</h2>
<p><img src="__GHOST_URL__/content/images/2022/03/a40a1329fd5e6b07239fb0c82be4ecb8.jpeg" alt="Man on a beach, sand falling between their fingers with the word &quot;terraform&quot; on the top centre, and &quot;state bucket&quot; at the bottom centre">Meme</p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed"><article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="http://localhost:1313/post/scamming-back-the-scammers/">
    
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Scamming back the scammers</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p><p>Disclaimer: I do not accept any responsibility for your actions, what you do or decide not to, is up to you. This blog post serves as a ‚ÄúHere‚Äôs what I did‚Äù opposed to a ‚ÄúHere‚Äôs how to do it‚Äù</p>
<p>Without wasting more time, let‚Äôs get to it.</p>
<p>Recently I got one of the texts every citizen of the UK has got at some point in their life - A parcel has attempted to be delivered - Pay for it!</p></p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="0001-121-01">1 January 0001</time>
                            <span class="bull">&bull;</span> 3 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
    

            <article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="http://localhost:1313/post/nginx-reverse/">
    
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Nginx and Lets encrypt, a story of reverse proxying</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p><p>This is something that took some time to get my head around, but once I managed to (somewhat) figure it out, it&rsquo;s made exposing my services to the internet a lot easier</p>
<p>After a few years of building up the courage and knowledge to host stuff that my friends and I can use, it&rsquo;s become apparent that updating a DNS record every time your public IP at home changes, isn&rsquo;t a great way to host things. This is where Nginx reverse proxy comes in.</p></p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="0001-121-01">1 January 0001</time>
                            <span class="bull">&bull;</span> 8 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
    
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:1313/">Hugo Themes</a> &copy; 0001</section>
                <nav class="site-footer-nav">
                    <a href="http://localhost:1313/">Latest Posts</a>
                    <a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a>
                    <a href="https://twitter.com" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://github.com/jonathanjanssens" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

<script src="http://localhost:1313/js/sticky-nav-title.min.7c74baa114d72c67b1f5c85f55da35fa76c686efef35103f409f57f6bf3f9057.js" integrity="sha256-fHS6oRTXLGex9chfVdo1&#43;nbGhu/vNRA/QJ9X9r8/kFc="></script>
<script>

    
    
    
    
    $(document).ready(function () {

        var nav = document.querySelector('.site-nav-main .site-nav');
        var feed = document.querySelector('.post-feed');

        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;

        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }

        function onResize() {
            lastWindowHeight = window.innerHeight;
            lastDocumentHeight = $(document).height();
            requestTick();
        }

        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(update);
            }
            ticking = true;
        }

        function update() {
            var trigger = feed.getBoundingClientRect().top + window.scrollY;
            var progressMax = lastDocumentHeight - lastWindowHeight;

            
            if (lastScrollY >= trigger - 20) {
                nav.classList.add('fixed-nav-active');
            } else {
                nav.classList.remove('fixed-nav-active');
            }

            ticking = false;
        }

        window.addEventListener('scroll', onScroll, { passive: true });
        window.addEventListener('resize', onResize, false);

        update();

    });
</script>
</body>
</html>