<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
    <title>Self hosted analytics · Hugo Themes</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="http://localhost:1313/style.main.min.b98e12e6b4acb157747422458845caf0880e6eda788e2e2ee3ecc617a0e9bfc3.css" />

</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
    <div class="site-nav-left">
        
        <a class="site-nav-logo" href="http://localhost:1313/">Hugo Themes</a>
        

        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem">
                    <a href="/">HOME</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="/my-setup">MY SETUP</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="/story">THE STORY</a>
                </li>
                
            </ul>

            
            <span class="nav-post-title dash">Self hosted analytics</span>
            
        </div>
    </div>

    <div class="site-nav-right">
        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem">
                    <a href="https://www.linkedin.com/in/bradley-stannard/">Linkedin</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="https://documentation.breadnet.co.uk/?mtm_campaign=breadnet&amp;mtm_kwd=navbar">Documentation</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="mailto:webmaster@breadnet.co.uk">Contact</a>
                </li>
                
                <li class="nav-home" role="menuitem">
                    <a href="https://github.com/userbradley">GitHub</a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>
</div>
</div><script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.Casper && window.Casper.stickyNavTitle) {
                window.Casper.stickyNavTitle({
                    navSelector: '.site-nav-main',
                    titleSelector: '.post-full-title',
                    activeClass: 'nav-post-title-active'
                });
            }
        });
    </script>
</header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post  no-image ">

            <header class="post-full-header">

                

                <h1 class="post-full-title">Self hosted analytics</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        

                        <section class="post-full-byline-meta">
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="0001-121-01">1 January 0001</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 5 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            

            <section class="post-full-content">
                <div class="post-content">
                    <p>The worst part about self hosting stuff is not having that seamless transition between applications built by google, microsoft and others, to being able to control the data your self.</p>
<p>My biggest annoyance was being able to see how many hits my page got, where people came to my site from, as well as what people were searching for. This allows me to know what people like (for example most people came to my site to see me use s3 with jellyfin and nginx reverse proxy) so I can write more posts for them</p>
<p>Today we will look at web analytics. A controversial topic depending on who you ask.</p>
<p>Let&rsquo;s get started.</p>
<p>We will be installing something called Matomo on to our web server. This server can be located on your server proxied to the outside world, or on a droplet or on AWS if you roll that way, It scales well.</p>
<p>What we will be installing:</p>
<pre><code>nginx
mariadb-server mariadb-client
software-properties-common
(repo) ppa:ondrej/php
php7.2-fpm php7.2-common php7.2-sqlite php7.2-curl php7.2-intl php7.2-mbstring php7.2-xmlrpc php7.2-mysql php7.2-gd php7.2-xml php7.2-cli php7.2-zip
unzip
</code></pre>
<p>If you already have these things installed, that&rsquo;s great. You can just skip the part where we need to install them. On Ubuntu (The os for my server) it doesnt hurt to install something twice.</p>
<p>Because I am lazy and dont like having to type <code>sudo</code> at the start of every command, we will start by logging in as root.</p>
<p>If your server is remote, you may need to connect via ssh. I have a guide!
[</p>
<p>A beginners guide to SSH</p>
<p>Sweet, you just got a linux server running on <!-- raw HTML omitted --> but nowyou need to actually do something on it. You tried to use the web console but now you need to paste something in&hellip; Itdoesn’t work? Shit. Luckilly SSH was designed to allow for Secure SHell accessto a server. (Hence S…</p>
<p><img src="https://breadnet.co.uk/favicon.png" alt="">breadNETBradley Stannard</p>
<h2 id="ghost_a-beginners-guide-to-ssh"><img src="https://images.unsplash.com/photo-1586772002345-339f8042a777?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="">
](<strong>GHOST_URL</strong>/a-beginners-guide-to-ssh/)</h2>
<p>Login as root</p>
<pre><code>sudo -s
</code></pre>
<hr>
<p>Install all the software (in one go as I&rsquo;m lazy and like doing it in blocks)</p>
<p>First add the PHP repo and apt-update</p>
<pre><code>add-apt-repository ppa:ondrej/php
apt-get update
</code></pre>
<p>Then all the rest we need!</p>
<pre><code>apt-get install nginx mariadb-server mariadb-client software-properties-common php7.2-fpm php7.2-common php7.2-sqlite php7.2-curl php7.2-intl php7.2-mbstring php7.2-xmlrpc php7.2-mysql php7.2-gd php7.2-xml php7.2-cli php7.2-zip unzip -y
</code></pre>
<p>Once everything is installed, edit the <code>php7.2</code> config file</p>
<pre><code>sudo nano /etc/php/7.2/fpm/php.ini
</code></pre>
<p>Find the below and change them</p>
<pre><code>file_uploads = On
allow_url_fopen = On
short_open_tag = On
cgi.fix_pathinfo = 0
memory_limit = 256M
upload_max_filesize = 100M
max_execution_time = 360
date.timezone = UTC
</code></pre>
<p>Restart nginx</p>
<pre><code>systemctl restart nginx
</code></pre>
<hr>
<p>Now we can configure the database for Matomo.</p>
<p>if you already have mariadb or mysql configured, skip this step as I <em>think</em> it can cause issues  ¯_(ツ)_/¯</p>
<pre><code>mysql_secure_installation
</code></pre>
<p>You will be prompted to answer the below:</p>
<pre><code>Enter current password for root (enter for none): Just press the Enter

Set root password? [Y/n]: Y

New password: Enter password

Re-enter new password: Repeat password

Remove anonymous users? [Y/n]: Y

Disallow root login remotely? [Y/n]: Y

Remove test database and access to it? [Y/n]:  Y

Reload privilege tables now? [Y/n]:  Y
</code></pre>
<p>Sweet, now we need to create a database user as well as a database for Matomo to use</p>
<p>login to mysql</p>
<pre><code>mysql -u root -p
</code></pre>
<p>Now create a database called matomo (You can call your&rsquo;s what ever you like)</p>
<pre><code>create database matomo;
</code></pre>
<p>Now create a user called matomousr. Use step <code>A</code> if you&rsquo;re running the database server on the same host, or step <code>B</code> if a remote server will have matomo.</p>
<h2 id="a">A</h2>
<pre><code>create user 'matomousr'@'localhost' identified by 'matomo_user_password';
</code></pre>
<h2 id="b">B</h2>
<pre><code>create user 'matomousr'@'&lt;nginx_ip&gt; identified by 'matomo_user_password';
</code></pre>
<p>Now we need to grant permissions for <code>matomousr</code> to use the database</p>
<pre><code>GRANT ALL ON matomo.* TO 'matomousr'@'&lt;localhost or nginx server ip&gt;' IDENTIFIED BY 'matomo_user_password' WITH GRANT OPTION;
</code></pre>
<p>Now flush privileges and exit</p>
<pre><code>FLUSH PRIVILEGES;
EXIT;
</code></pre>
<hr>
<p>Nice, you&rsquo;ve made it this far. I promise it&rsquo;s alomsot over!</p>
<p>Download and install matomo - It used to be called &lsquo;Piwiki&rsquo; so dont worry about the file name</p>
<pre><code>cd /tmp &amp;&amp; wget https://builds.matomo.org/piwik.zip
unzip piwik.zip
sudo mv piwik /var/www/matomo
</code></pre>
<p>Now we need to fix the permissions</p>
<pre><code>sudo chown -R www-data:www-data /var/www/matomo/
sudo chmod -R 755 /var/www/matomo/
</code></pre>
<hr>
<p>NGINX part</p>
<p>For simplicity I like to make my nginx config files names&rsquo; reflect their site url. So the file would be <code>test.breadnet.co.uk</code> would point to&hellip; well, you guessed it. No need to tell you :)</p>
<p>Before you move on, pick a subdomain for matomo to run on. I made the stupid decision of going &lsquo;What&rsquo;s the short version of analytics? huh, anal&hellip; cool.&rsquo; so pick something like <code>tracking.domain</code> or <code>watcher.domain</code></p>
<pre><code>nano /etc/nginx/sites-available/&lt;subdomain&gt;.yourdomain.tld
</code></pre>
<p>In the open window paste:</p>
<pre><code>server {
    listen 80;
    listen [::]:80;
    root /var/www/html/matomo;
    index  index.php index.html index.htm;
    server_name &lt;subdomain&gt;.yourdomain.tld www.&lt;subdomain&gt;.yourdomain.tld;

    client_max_body_size 100M;

    location / {
        try_files $uri /index.php?$query_string;
       }

    location ~ \.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_pass             unix:/var/run/php/php7.2-fpm.sock;
    fastcgi_param   SCRIPT_FILENAME $document_root$fastcgi_script_name;
     }
}
</code></pre>
<p>Save and exit (Ctrl + x, y, enter)</p>
<p>Now we canenable the site</p>
<pre><code>ln -s /etc/nginx/sites-available/&lt;subdomain&gt;.yourdomain.tld /etc/nginx/sites-enabled/&lt;subdomain&gt;.yourdomain.tld
</code></pre>
<p>Restart nginx</p>
<pre><code>systemctl restart nginx
</code></pre>
<p>You will need to add a DNS A record (Or AAAA record if you&rsquo;re cool and use IPV6) pointing the <code>&lt;subdomain&gt;</code> part to your server&rsquo;s IP address.</p>
<p>Opoen your browser and go to the url of your matomo instance and you&rsquo;ll need to run through the setup. It&rsquo;s straightforward.</p>
<hr>
<p>Adding a site is rather simple.</p>
<p>Once logged in, go to the gear icon at the top right:
<img src="__GHOST_URL__/content/images/2020/08/image-11.png" alt="">
Then you will see a section called <code>Quick Links</code> at the top.
<img src="__GHOST_URL__/content/images/2020/08/image-13.png" alt="">
Click the <code>Add a new website</code></p>
<p>Select what the site is:
<img src="__GHOST_URL__/content/images/2020/08/image-14.png" alt="">
Specify the Name and the URL, then scroll down and click save.</p>
<p>Once it&rsquo;s saved, click the <code>View tracking code</code> section to get the secret sauce you need to add to your site
<img src="__GHOST_URL__/content/images/2020/08/image-15.png" alt="">
if you scroll down you will see a box like the below. You need to add this to the header or footer of every page you want to track:
<img src="__GHOST_URL__/content/images/2020/08/image-16.png" alt="">
If you have any issues or questions, feel free to get in contact!</p>
<hr>
<p>You can hire me via <a href="https://www.upwork.com/freelancers/~01c61ee9802b94133e">Upwork</a> or <a href="mailto:work@breadnet.co.uk">emailing me</a> for weekend projects!</p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed"><article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="http://localhost:1313/post/self-hosters-guide-to-the-cloud/">
    
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Self hosters guide to the cloud</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p><ul>
<li>services to offer</li>
<li>how it&rsquo;s different</li>
<li>ways to manage it</li>
<li>best practices</li>
<li>how to make the most of it</li>
<li>companies I suggest</li>
</ul>
<p>I&rsquo;ll be honest with eneryone here, I never thought I would ever write something like this.</p>
<p>The time has come, I am moving my servers to the cloud.</p>
<p>I still am a selfhoster as I rely on my own knowledge and experience to operate all my services and ensure that they are online for the people who have come to rely on them.</p></p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="0001-121-01">1 January 0001</time>
                            <span class="bull">&bull;</span> 6 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
    

            <article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="http://localhost:1313/post/scamming-back-the-scammers/">
    
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Scamming back the scammers</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p><p>Disclaimer: I do not accept any responsibility for your actions, what you do or decide not to, is up to you. This blog post serves as a “Here’s what I did” opposed to a “Here’s how to do it”</p>
<p>Without wasting more time, let’s get to it.</p>
<p>Recently I got one of the texts every citizen of the UK has got at some point in their life - A parcel has attempted to be delivered - Pay for it!</p></p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="0001-121-01">1 January 0001</time>
                            <span class="bull">&bull;</span> 3 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
    
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:1313/">Hugo Themes</a> &copy; 0001</section>
                <nav class="site-footer-nav">
                    <a href="http://localhost:1313/">Latest Posts</a>
                    <a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a>
                    <a href="https://twitter.com" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://github.com/jonathanjanssens" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

<script src="http://localhost:1313/js/sticky-nav-title.min.7c74baa114d72c67b1f5c85f55da35fa76c686efef35103f409f57f6bf3f9057.js" integrity="sha256-fHS6oRTXLGex9chfVdo1&#43;nbGhu/vNRA/QJ9X9r8/kFc="></script>
<script>

    
    
    
    
    $(document).ready(function () {

        var nav = document.querySelector('.site-nav-main .site-nav');
        var feed = document.querySelector('.post-feed');

        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;

        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }

        function onResize() {
            lastWindowHeight = window.innerHeight;
            lastDocumentHeight = $(document).height();
            requestTick();
        }

        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(update);
            }
            ticking = true;
        }

        function update() {
            var trigger = feed.getBoundingClientRect().top + window.scrollY;
            var progressMax = lastDocumentHeight - lastWindowHeight;

            
            if (lastScrollY >= trigger - 20) {
                nav.classList.add('fixed-nav-active');
            } else {
                nav.classList.remove('fixed-nav-active');
            }

            ticking = false;
        }

        window.addEventListener('scroll', onScroll, { passive: true });
        window.addEventListener('resize', onResize, false);

        update();

    });
</script>
</body>
</html>